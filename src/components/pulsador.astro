---
export const prerender = false;
import Timer from "../components/timer.astro";
---

<h2 class="p-title">Concursantes</h2>

<section class="p-grid">
  <!-- Columna 1: Listas -->
  <div class="p-card">
    <p class="p-subtitle">
      Participantes que han pulsado: <span id="countOn">0</span>
    </p>
    <div id="listOn" class="p-list"></div>

    <div class="p-divider" aria-hidden="true"></div>

    <p class="p-subtitle">
      Participantes que no han pulsado: <span id="countOff">0</span>
    </p>
    <div id="listOff" class="p-list"></div>
  </div>

  <!-- Columna 2: Turno + Timer + Resultados + Reset -->
  <div class="p-card p-center">
    <div class="turno">
      <span class="turno__label">Turno de:</span>
      <span class="turno__name" data-turn-name>—</span>
    </div>

    <!-- Temporizador -->
    <Timer />

    <!-- Botones de resultado (pulsador.js los gestiona) -->
    <div id="resultBtns" class="result-btns hidden">
      <button id="btnAcierto" class="p-btn success">✅ Acierto</button>
      <button id="btnFallado" class="p-btn danger hidden">❌ Fallado</button>
    </div>

    <button id="resetBtn" class="p-btn reset-btn">Resetear</button>
  </div>

  <!-- Columna 3: Marcador -->
  <div class="p-card p-center score-card">
    <h3 class="score-title">Marcador</h3>
    <table class="score-table" aria-label="Marcador">
      <thead>
        <tr>
          <th>JUGADOR</th>
          <th>PUNTOS</th>
        </tr>
      </thead>
      <tbody id="scoreBody">
        <tr><td class="empty" colspan="2">Cargando…</td></tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Carga de scripts desde /public/scripts (funciona en local y en Vercel) -->
<script >
  import("../scripts/pulsador.js").then(m => m.initPulsador());
  import("../scripts/timer.js").then(m => m.initTimer());
</script>

<style>
/* ====== Modo oscuro ====== */
.p-title{
  text-align:center;
  color:#93c5fd;
  font-size:2.2rem;
  margin:24px 0 18px;
  font-weight:800;
}

/* ====== Fila principal ====== */
.p-grid{
  max-width:1100px;
  margin:0 auto 64px;
  display:grid;
  gap:24px;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  align-items:stretch;
}
@media (max-width: 980px){ .p-grid{ grid-template-columns: 1fr; } }

/* ====== Tarjetas ====== */
.p-card{
  height: 100%;
  background:#1e293b;
  border-radius:16px;
  border:1px solid #334155;
  box-shadow:0 6px 18px rgba(0,0,0,.4);
  padding:18px 20px;
  color:#f1f5f9;
}
.p-center{ display:flex; flex-direction:column; align-items:center; }

/* ====== Listas ====== */
.p-subtitle{ margin:0 0 10px; font-weight:700; color:#f9fafb; }
.p-divider{ height:1px; background:#334155; margin:12px 0; }
.p-list{ display:grid; gap:8px; }
.p-list p{
  margin:0;
  padding:8px 12px;
  background:#0f172a;
  border:1px solid #334155;
  border-left:4px solid #3b82f6;
  border-radius:8px;
  font-size:.95rem;
  color:#f9fafb;
}

/* ====== Botones ====== */
.p-btn{
  min-width:0;
  padding:12px 22px;
  font-weight:800;
  border:none;
  border-radius:12px;
  background:#2563eb;
  color:#fff;
  cursor:pointer;
  transition:transform .12s ease, background-color .15s ease, box-shadow .2s ease;
}
.p-btn:hover{ background:#1d4ed8; transform: translateY(-1px); }
.p-btn:disabled{ opacity:.65; cursor:not-allowed; }
.p-btn.success{ background:#15803d; } .p-btn.success:hover{ background:#166534; }
.p-btn.danger{  background:#b91c1c; } .p-btn.danger:hover{  background:#991b1b; }
.reset-btn{ margin-top:14px; }

/* ====== Contenedor de resultados ====== */
.result-btns{
  margin-top:14px;
  display:grid;
  grid-template-columns: 1fr;
  gap:12px;
  width:100%;
  max-width: 440px;
  min-height:56px;
}
@media (min-width: 680px){
  .result-btns{ grid-template-columns: repeat(2, 1fr); }
}
.result-btns .p-btn{ width:100%; }

/* Si está .hidden, mantenemos el hueco para que no “salte” el layout */
#resultBtns.hidden{
  display:grid !important;
  visibility:hidden;
  opacity:0;
  pointer-events:none;
}

/* ====== Turno / Timer ====== */
.turno{ margin:4px 0 12px; font-weight:800; color:#e2e8f0; text-align:center; }
.turno__label{ opacity:.7; margin-right:.35rem; }
.turno__name{ letter-spacing:.5px; }

/* ====== Marcador ====== */
.score-card{ text-align:center; }
.score-title{ margin:0 0 12px; color:#93c5fd; font-weight:800; }

.score-table{
  width:100%;
  border-collapse:separate;
  border-spacing:0 10px;
  table-layout:fixed;
}
.score-table thead th{
  background:#334155;
  color:#f9fafb;
  font-weight:900;
  text-transform:uppercase;
  font-size:.86rem;
  padding:12px 14px;
}
.score-table tbody tr{ background:#0f172a; color:#f9fafb; }
.score-table .empty{ text-align:center; color:#94a3b8; padding:12px; }
</style>
